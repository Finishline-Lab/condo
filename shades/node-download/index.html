<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name=description content="Condo, a build system for DNX-based projects, including the CoreCLR, ASP.NET 5 and MVC 6."><meta name=keywords content="DNX, CoreCLR, net451, netcore50, build system, development, vnext"><meta name=author content="Deavon McCaffery, PulseBridge, Inc., and condo contributors"><title>node-download &middot; PulseBridge &middot; Condo</title><link href=/condo/assets/css/docs.min.css rel=stylesheet><link rel="apple-touch=-icon" href=/condo/apple-touch-icon.png><link rel=icon href=/condo/favicon.ico><script>
  document.createElement("picture");
</script><script src=/condo/assets/js/picturefill.min.js async></script><script type=text/javascript>
  var appInsights=window.appInsights||function(config){
    function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t
    }({
        instrumentationKey:"1be399a0-4935-4997-ab22-3345e07cabd7"
    });

    window.appInsights=appInsights;
    appInsights.trackPageView();
</script></head><body class=docs data-spy=scroll data-target=.docs-sidenav-active><a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-light navbar-static-top docs-navbar" role=banner><div class=container><div class=clearfix><button class="navbar-toggler pull-xs-right hidden-sm-up" type=button data-toggle=collapse data-target=#docs-main-nav>&#9776;</button> <a class="navbar-brand hidden-sm-up" href="/condo/"><picture><source type=image/svg+xml srcset=/condo/assets/img/open.svg><img src=/condo/assets/img/open.png srcset="/condo/assets/img/open@2x.png 2x, /condo/assets/img/open@3x.png 3x"></picture></a></div><div class="collapse navbar-toggleable-xs" id=docs-main-nav><nav class="nav navbar-nav"><a class="navbar-brand hidden-sm-down" href="/condo/"><picture><source type=image/svg+xml srcset=/condo/assets/img/open.svg><img src=/condo/assets/img/open.png srcset="/condo/assets/img/open@2x.png 2x, /condo/assets/img/open@3x.png 3x"></picture></a> <a class="nav-item nav-link" href="/condo/" onclick=appInsights.trackEvent( navbar ", {area: "community name: "condo "});">Condo</a> <a class="nav-item nav-link" href="/condo/start/overview/" onclick=appInsights.trackEvent( navbar ", {area: "community name: "documentation "});">Documentation</a> <a class="nav-item nav-link" href="/condo/examples/" onclick=appInsights.trackEvent( navbar ", {area: "community name: "examples "});">Examples</a></nav></div></div></header><div class=docs-pageheader><div class=container><h1>Shades</h1><p class=lead>A collection of shades (actions) that can be called to perform various tasks or functions during the build lifecycle.</p></div></div><div class=container><div class=row><div class="col-md-2 col-md-push-10 docs-sidebar"><div class=docs-sidebar><div id=search-container class="docs-search hidden-sm-down"><input type=text class=form-control id=search-input placeholder=filter... autocomplete=off><div class="dropdown-menu docs-search-results" id=search-results></div></div><nav class=docs-links id=docsNavbarContent><div class=docs-toc-item><a class=docs-toc-link href=/condo/start/overview>Start</a><ul class="nav docs-sidenav"><li><a href=/condo/start/overview>Overview</a></li><li><a href=/condo/start/prerequisites>Prerequisites</a></li><li><a href=/condo/start/default-lifecycle>Default Lifecycle</a></li><li><a href=/condo/start/default-goals>Default Goals</a></li><li><a href=/condo/start/best-practices>Best Practices</a></li><li><a href=/condo/start/semantic-versioning>Semantic Versioning</a></li></ul></div><div class="docs-toc-item active"><a class=docs-toc-link href=/condo/shades/bower>Shades</a><ul class="nav docs-sidenav"><li><a href=/condo/shades/bower>bower</a></li><li><a href=/condo/shades/bower-download>bower-download</a></li><li><a href=/condo/shades/bower-install>bower-install</a></li><li><a href=/condo/shades/brew>brew</a></li><li><a href=/condo/shades/brew-download>brew-download</a></li><li><a href=/condo/shades/brew-install>brew-install</a></li><li><a href=/condo/shades/bundle>bundle</a></li><li><a href=/condo/shades/bundle-download>bundle-download</a></li><li><a href=/condo/shades/bundle-install>bundle-install</a></li><li><a href=/condo/shades/copy>copy</a></li><li><a href=/condo/shades/dnu>dnu</a></li><li><a href=/condo/shades/dnvm-locate>dnvm-locate</a></li><li><a href=/condo/shades/dnx>dnx</a></li><li><a href=/condo/shades/dnx-run>dnx-run</a></li><li><a href=/condo/shades/dnx-test>dnx-test</a></li><li><a href=/condo/shades/dnx-watch>dnx-watch</a></li><li><a href=/condo/shades/dnx-watch-download>dnx-watch-download</a></li><li><a href=/condo/shades/dotnet-build>dotnet-build</a></li><li><a href=/condo/shades/dotnet-clean>dotnet-clean</a></li><li><a href=/condo/shades/dotnet-cover>dotnet-cover</a></li><li><a href=/condo/shades/dotnet-cover-report>dotnet-cover-report</a></li><li><a href=/condo/shades/dotnet-pack>dotnet-pack</a></li><li><a href=/condo/shades/dotnet-restore>dotnet-restore</a></li><li><a href=/condo/shades/exec>exec</a></li><li><a href=/condo/shades/gem>gem</a></li><li><a href=/condo/shades/gem-install>gem-install</a></li><li><a href=/condo/shades/git>git</a></li><li><a href=/condo/shades/git-config>git-config</a></li><li><a href=/condo/shades/git-tag>git-tag</a></li><li><a href=/condo/shades/gm-download>gm-download</a></li><li><a href=/condo/shades/grunt>grunt</a></li><li><a href=/condo/shades/grunt-download>grunt-download</a></li><li><a href=/condo/shades/gulp>gulp</a></li><li><a href=/condo/shades/gulp-download>gulp-download</a></li><li><a href=/condo/shades/gulp-list>gulp-list</a></li><li><a href=/condo/shades/gulp-task>gulp-task</a></li><li><a href=/condo/shades/info>info</a></li><li><a href=/condo/shades/info-collect>info-collect</a></li><li><a href=/condo/shades/log>log</a></li><li><a href=/condo/shades/mkdir>mkdir</a></li><li><a href=/condo/shades/mocha>mocha</a></li><li><a href=/condo/shades/mocha-download>mocha-download</a></li><li><a href=/condo/shades/node>node</a></li><li class="active docs-sidenav-active"><a href=/condo/shades/node-download>node-download</a></li><li><a href=/condo/shades/npm>npm</a></li><li><a href=/condo/shades/npm-install>npm-install</a></li><li><a href=/condo/shades/nuget>nuget</a></li><li><a href=/condo/shades/nuget-download>nuget-download</a></li><li><a href=/condo/shades/nuget-install>nuget-install</a></li><li><a href=/condo/shades/nuget-pack>nuget-pack</a></li><li><a href=/condo/shades/nuget-push>nuget-push</a></li><li><a href=/condo/shades/nuget-restore>nuget-restore</a></li><li><a href=/condo/shades/rimraf>rimraf</a></li><li><a href=/condo/shades/rimraf-download>rimraf-download</a></li><li><a href=/condo/shades/ruby>ruby</a></li><li><a href=/condo/shades/ruby-locate>ruby-locate</a></li><li><a href=/condo/shades/run>run</a></li><li><a href=/condo/shades/tsd>tsd</a></li><li><a href=/condo/shades/tsd-download>tsd-download</a></li><li><a href=/condo/shades/update-self>update-self</a></li><li><a href=/condo/shades/verify-hash>verify-hash</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/condo/utilities/build-tools>Utilities</a><ul class="nav docs-sidenav"><li><a href=/condo/utilities/build-tools>Build Tools</a></li><li><a href=/condo/utilities/assembly-info>Assembly Info</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/condo/about/history>About</a><ul class="nav docs-sidenav"><li><a href=/condo/about/history>History</a></li><li><a href=/condo/about/team>Team</a></li><li><a href=/condo/about/license>License</a></li></ul></div></nav></div></div><div class="col-md-10 col-md-pull-2 docs-content"><h1 class=docs-title id=content>node-download</h1><p>@{/*</p><p>node-download Downloads and installs node if it is not already installed either locally or globally.</p><p>node_download_path=’$(base_path)/bin/nodejs’ The path in which to install node.</p><p>base_path=’$(CurrentDirectory)’ The base path in which to install node.</p><p>*/}</p><p>use assembly = ‘System.IO.Compression.FileSystem, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089’</p><p>use namespace = ‘System’ use namespace = ‘System.IO’ use namespace = ‘System.IO.Compression’ use namespace = ‘System.Net’</p><p>use import = ‘Condo.Build’</p><p>default base_path = ‘${ Directory.GetCurrentDirectory() }’</p><p>default node_download_path = ‘${ Path.Combine(base_path, “bin”, “nodejs”) }’ default node_version = ‘0.10.28’ default npm_version = ‘1.4.9’</p><p>default node_hash = ‘628FFD6C3577068C00CEC9F6F897F0EC8F5212D9’</p><p>@{ Build.Log.Header(“node-download”);</p><div class=highlighter-rouge><pre class=highlight><code>var node_exe                = "node.exe";
var node_dist               = "http://nodejs.org/dist";
var node_url                = node_dist + "/v" + node_version + "/" + node_exe;
var node_install            = Path.Combine(node_download_path, node_exe);

var npm_zip                 = "npm-" + npm_version + ".zip";
var npm_url                 = node_dist + "/npm/" + npm_zip;
var npm_install             = Path.Combine(node_download_path, npm_zip);
var npm_cmd_install         = Path.Combine(node_download_path, "npm.cmd");

var node_locally_installed  = File.Exists(node_install);
var node_globally_installed = Build.TryExecute("node", out node_version, "--version");
var npm_globally_installed  = Build.TryExecute("npm", out npm_version, "--version");
var node_installed          = node_globally_installed || node_locally_installed;

node_install = node_globally_installed || Build.Unix ? "node" : node_install;
npm_cmd_install = npm_globally_installed || Build.Unix ? "npm" : npm_cmd_install;

if (!node_installed)
{
    if (Build.OSX)
    {
        node_install = "node";
        npm_cmd_install = "npm";
    }
    else if (Build.Unix)
    {
        throw new Exception("node-download: you must install node manually for Linux environments.");
    }
    else
    {
        Log.Info(string.Format("--installing nodejs to: {0}", node_download_path));

        if (Directory.Exists(node_download_path))
        {
            Directory.Delete(node_download_path, recursive: true);
        }

        Directory.CreateDirectory(node_download_path);

        using(var client = new WebClient())
        {
            Log.Info(string.Format("--downloading nodejs from: {0} to: {1}", node_url, node_install));
            client.DownloadFile(node_url, node_install);

            Log.Info(string.Format("--downloading npm from: {0} to: {1}", npm_url, npm_install));
            client.DownloadFile(npm_url, npm_install);

            Log.Info(string.Format("--extracting npm from: {0} to: {1}", npm_install, node_download_path));
            ZipFile.ExtractToDirectory(npm_install, node_download_path);
        }
    }
}

// attempt to retreive node version
Build.TryExecute(node_install, out node_version, "--version");

// attempt to retrieve npm version
Build.TryExecute(npm_cmd_install, out npm_version, "--version");

Build.SetPath("node", node_install, node_globally_installed);
Build.SetPath("npm", npm_cmd_install, node_globally_installed); }
</code></pre></div><p>verify-hash verify_assembly=’${ node_install }’ verify_hash=’${ node_hash }’ if=’!node_installed &amp;&amp; !Build.Unix’ brew-install brew_install_formula=’node’ if=’!node_installed &amp;&amp; Build.OSX’</p><p>@{ Build.Log.Argument(“node path”, node_install); Build.Log.Argument(“npm path”, npm_cmd_install); Build.Log.Argument(“version”, node_version); Build.Log.Argument(“npm version”, npm_version); Build.Log.Header(); }</p></div></div></div><footer class="docs-footer text-muted" role=contentinfo><div class=container><ul class=docs-footer-links><li><a href=https://github.com/pulsebridge/condo>GitHub</a></li><li><a href=https://twitter.com/pulsebridge>Twitter</a></li><li><a href="/condo/examples/">Examples</a></li><li><a href="/condo/about/history/">About</a></li></ul><p>Designed and built primarily by <a href=https://twitter.com/dmccaffery target=_blank>@dmccaffery</a>. Maintained by the <a href=https://github.com/orgs/pulsebridge/people>PulseBridge team</a> with the help of <a href=https://github.com/pulsebridge/condo/graphs/contributors>our contributors</a>.</p><p>Currently v1.0.0-rc. Code licensed <a rel=license href=/condo/about/license>MIT</a>, docs <a rel=license href="https://creativecommons.org/licenses/by/3.0/" target=_blank>CC BY 3.0</a>.</p><br><p>See an issue on this page? <a href="https://github.com/pulsebridge/condo/issues/new?title=Docs%20-%20node-download&body=Why%20you%20no%20work?&labels[]=docs" target=_new>Report it on GitHub</a></p></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js></script><script>window.jQuery || document.write('<script src="/condo/assets/js/vnd/jquery/jquery.min.js"><\/script>')</script><script src=/condo/assets/js/docs.min.js></script><script src=/condo/assets/js/search.min.js></script></body></html>